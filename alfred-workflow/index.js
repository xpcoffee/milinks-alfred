var y=Object.create;var a=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var w=(t,e)=>{for(var r in e)a(t,r,{get:e[r],enumerable:!0})},m=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of G(e))!O.call(t,i)&&i!==r&&a(t,i,{get:()=>e[i],enumerable:!(n=N(e,i))||n.enumerable});return t};var l=(t,e,r)=>(r=t!=null?y(A(t)):{},m(e||!t||!t.__esModule?a(r,"default",{value:t,enumerable:!0}):r,t)),v=t=>m(a({},"__esModule",{value:!0}),t);var j={};w(j,{script:()=>M});module.exports=v(j);var f=l(require("fuzzy-search")),p=require("fs"),d=l(require("path")),k=require("os"),g=l(require("axios"));async function M(){var L;let t=((L=process.env.MILINKS_SEARCH_ALL)==null?void 0:L.toLowerCase())==="true",e=process.env.MILINKS_FILE_PATH,r=process.env.MILINKS_GROUP,[n,i,o]=process.argv,u=r?P(r):R(e);function s(){let c=J(u),S=b(c,o);return E(S)}async function h(){let c=await x(u);return{items:z(c,o)}}let I=t?s():await h();console.log(JSON.stringify(I))}function P(t){try{return JSON.parse(t)}catch(e){console.error("Unable to parse link group into JSON: "+e),process.exit(1)}}function R(t){t||(console.error("No MiLinks file path."),process.exit(1));try{let e=(0,p.readFileSync)(_(t),"utf-8");return JSON.parse(e)}catch(e){console.error("Unable to parse link file into JSON: "+e),process.exit(1)}}function _(t){return t[0]==="~"?d.default.join((0,k.homedir)(),t.slice(1)):t}async function x(t){function e(n){return{uid:Date.now().toString(),title:n.name,arg:"group",variables:{MILINKS_GROUP:JSON.stringify(n)}}}return(await Promise.all(t.items.map(async n=>{if(n.type==="group")return e(n);if(n.type==="link")return F({...n,groupName:t.name});if(n.type==="groupRef"){let i=await U(n);return i?e(i):void 0}}))).filter(n=>n!==void 0)}function J(t){let e=[];function r(n,i,o){if(i.type==="group"){let u=[o,i.name].filter(s=>s!==void 0&&(s==null?void 0:s.length)).join("/");i.items.forEach(s=>r(n,s,u))}else i.type==="link"&&n.push({...i,groupName:o})}return r(e,t),e}function b(t,e){if(!e)return t;let r=e.split(" "),n=t;return r.forEach(i=>{n=new f.default(n,["description","title","groupName"]).search(i)}),n}function z(t,e){if(!e)return t;let r=e.split(" "),n=t;return r.forEach(i=>{n=new f.default(n,["title"]).search(i)}),n}function E(t){return{items:t.map(F)}}function F(t){let e=[t.groupName,t.description,t.url].filter(r=>r!==void 0&&(r==null?void 0:r.length)).join(" | ");return{uid:t.title,title:t.title,subtitle:e,arg:t.url,variables:{url:t.url}}}async function U({url:t,alias:e}){let r="file://";if(t.startsWith(r)){let n=t.slice(r.length),i=(0,p.readFileSync)(n,"utf-8");return JSON.parse(i)}else{let i=(await(0,g.default)(t)).data;return e&&(i.name=e),i}}0&&(module.exports={script});
